<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://jiaqiwang98.github.io</id>
    <title>Jiaqi`s Blog</title>
    <updated>2021-11-08T06:33:48.231Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://jiaqiwang98.github.io"/>
    <link rel="self" href="https://jiaqiwang98.github.io/atom.xml"/>
    <subtitle>To be a better one.</subtitle>
    <logo>https://jiaqiwang98.github.io/images/avatar.png</logo>
    <icon>https://jiaqiwang98.github.io/favicon.ico</icon>
    <rights>All rights reserved 2021, Jiaqi`s Blog</rights>
    <entry>
        <title type="html"><![CDATA[Objective-Cã€ŒRuntimeæœºåˆ¶ã€å­¦ä¹ è®°å½•]]></title>
        <id>https://jiaqiwang98.github.io/post/objective-cruntime-ji-zhi-xue-xi-ji-lu/</id>
        <link href="https://jiaqiwang98.github.io/post/objective-cruntime-ji-zhi-xue-xi-ji-lu/">
        </link>
        <updated>2021-11-07T08:52:35.000Z</updated>
        <summary type="html"><![CDATA[<p>é˜…è¯»è¿™ç¯‡æ–‡ç« ä½ å°†çŸ¥é“OCæ¶ˆæ¯è½¬å‘çš„ä¸‰æ­¥å¤„ç†å¯ä»¥ç”¨æ¥åšä»€ä¹ˆ</p>
]]></summary>
        <content type="html"><![CDATA[<p>é˜…è¯»è¿™ç¯‡æ–‡ç« ä½ å°†çŸ¥é“OCæ¶ˆæ¯è½¬å‘çš„ä¸‰æ­¥å¤„ç†å¯ä»¥ç”¨æ¥åšä»€ä¹ˆ</p>
<!-- more -->
<h3 id="æœ€æ¨èé˜…è¯»">æœ€æ¨èé˜…è¯»ğŸŒŸï¼š</h3>
<p>ã€ŠiOS å¼€å‘ï¼šã€Runtimeã€è¯¦è§£ï¼ˆä¸€ï¼‰åŸºç¡€çŸ¥è¯†ã€‹ https://bujige.net/blog/iOS-Runtime-01.html</p>
<h3 id="å…¶ä»–æ¨èé˜…è¯»">å…¶ä»–æ¨èé˜…è¯»ï¼š</h3>
<p>ã€ŠObjective-C Runtimeã€‹https://yulingtianxia.com/blog/2014/11/05/objective-c-runtime/</p>
<p>ç½‘ç»œä¸Šå…³äºObjective-C Runtimeæ€»ç»“æ–‡ç« éå¸¸å¤šï¼Œæˆ‘è¿™é‡Œå°±å–æœ€æœ€ç²¾åçš„éƒ¨åˆ†ï¼Œåªæ”¾ä¸¤ç¯‡ã€‚å…¶ä¸­ç¬¬ä¸€ç¯‡æ˜¯æˆ‘çœ‹è¿‡çš„æ¡ç†æœ€æ¸…æ™°ï¼Œæœ€æ˜“æ‡‚çš„Runtimeæ–‡ç« ã€‚</p>
<h3 id="æˆ‘çš„å­¦ä¹ ä¸æ€è€ƒ">æˆ‘çš„å­¦ä¹ ä¸æ€è€ƒï¼š</h3>
<p>æˆ‘åœ¨é˜…è¯»ä»‹ç»Runtimeçš„åšå®¢æ—¶å‘ç°ï¼Œæ‰€æœ‰çš„æ–‡ç« éƒ½ä¼šè®²<code>[dog run];</code>è¿™æ ·ä¸€ä¸ªè°ƒç”¨æµç¨‹ï¼ˆä¸äº†è§£Objective-Cè¯­æ³•çš„å¯ä»¥è®¤ä¸ºæ˜¯dogå¯¹è±¡è°ƒç”¨äº†run()å‡½æ•°ï¼‰ï¼š</p>
<blockquote>
<p>é¦–å…ˆä¼šè¿›è¡Œ<strong>æ¶ˆæ¯å‘é€</strong>ï¼Œå»dogå¯¹è±¡æ‰€å±ç±»çš„å‡½æ•°è¡¨(methodLists)ä¸­å»æ‰¾æ˜¯å¦å®ç°äº†runå‡½æ•°ï¼Œå®ç°äº†åˆ™æ‰§è¡Œrunå‡½æ•°ã€‚å¦‚æœæ²¡æœ‰å®ç°runå‡½æ•°ï¼ŒObjective-Cçš„Runtimeåˆ™ä¼šè¿›å…¥<strong>æ¶ˆæ¯è½¬å‘</strong>æµç¨‹ï¼Œè¿›è¡Œ<strong>æ¶ˆæ¯åŠ¨æ€è§£æ</strong>ï¼Œ<strong>æ¶ˆæ¯æ¥å—è€…é‡å®šå‘</strong>ï¼Œ<strong>æ¶ˆæ¯é‡å®šå‘</strong>ä¸‰æ­¥å¤„ç†ï¼Œå¦‚æœè¿™ä¸‰æ­¥å¤„ç†éƒ½å¤±è´¥äº†ï¼Œå°±ä¼šæŠ›å‡ºæˆ‘ä»¬ç†Ÿæ‚‰çš„<code>unrecognized selector sent to instance</code>å¼‚å¸¸ã€‚</p>
</blockquote>
<p>ä½†æ˜¯å´å¾ˆå°‘æœ‰æ–‡ç« æåˆ°æˆ‘ä»¬èƒ½ç”¨æ¶ˆæ¯è½¬å‘çš„è¿™ä¸‰å¤„ç†æ¥åšä»€ä¹ˆã€‚é€šè¿‡é—®ç»„é‡Œçš„å¤§å“¥å’ŒæŸ¥é˜…èµ„æ–™äº†è§£åˆ°ï¼Œ<strong>æ¶ˆæ¯è½¬å‘çš„ä¸‰æ­¥æµç¨‹</strong>åœ¨ä¸šåŠ¡ä¸Šä½¿ç”¨è¾ƒå°‘ï¼Œä¸»è¦ä½¿ç”¨åœ¨ç¨‹åºçš„<strong>crashé˜²æŠ¤</strong>ä¸­ï¼Œè¿™å°±è§£ç­”äº†æˆ‘çš„å›°æƒ‘ã€‚ä¸‹é¢ç”¨ä¸€ä¸ªdemoæ¥å±•ç¤ºä¸‹æ˜¯å¦‚ä½•åˆ©ç”¨æ¶ˆæ¯è½¬å‘æœºåˆ¶å¯¹<code>unrecognized selector sent to instance</code>è¿™ç§crashè¿›è¡Œé˜²æŠ¤çš„ã€‚</p>
<p>å½“<code>[dog run]</code>ä¸­runå‡½æ•°æ²¡æœ‰å®ç°æ—¶ï¼Œæ¶ˆæ¯è½¬å‘ç»™æˆ‘ä»¬æä¾›äº†ä¸‰æ­¥å¤„ç†æ¥æŒ½å›ã€‚<br>
1.åœ¨<strong>æ¶ˆæ¯åŠ¨æ€è§£æ</strong>ä¸­è°ƒç”¨<code>+resolveInstanceMethod:</code>ä¸ºè¯¥ç±»åŠ¨æ€æ·»åŠ å‡½æ•°çš„å®ç°<br>
2.åœ¨<strong>æ¶ˆæ¯æ¥å—è€…é‡å®šå‘</strong>ä¸­è°ƒç”¨<code>-forwardingTargetForSelector:</code>å°†æ¶ˆæ¯è½¬å‘ç»™åˆ«çš„å¯¹è±¡ï¼ˆä»…é™ä¸€ä¸ªï¼‰ï¼Œçœ‹çœ‹taæœ‰æ²¡æœ‰å®ç°runå‡½æ•°<br>
3.åœ¨<strong>æ¶ˆæ¯é‡å®šå‘</strong>ä¸­è°ƒç”¨<code>-forwardInvocation:</code>å°†æ¶ˆæ¯è½¬ç»™å¤šä¸ªå¯¹è±¡ï¼Œå†è¯•ä¸€ä¸‹</p>
<h3 id="demoå®ç°">Demoå®ç°ï¼š</h3>
<p>è¿™é‡Œæˆ‘ä»¬åœ¨ç¬¬2æ­¥è¿›è¡Œæ‹¦æˆªï¼Œä¸ºä»€ä¹ˆæ˜¯åœ¨ç¬¬2æ­¥ï¼Œç½‘æ˜“å‰ç«¯æŠ€æœ¯å›¢é˜Ÿhttps://neyoufan.github.io/2017/01/13/ios/BayMax_HTSafetyGuard/ ç»™äº†åŸå› </p>
<blockquote>
<ol>
<li>+resolveInstanceMethod: éœ€è¦åœ¨ç±»çš„æœ¬èº«ä¸ŠåŠ¨æ€æ·»åŠ å®ƒæœ¬èº«ä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯¹äºè¯¥ç±»æœ¬èº«æ¥è¯´å†—ä½™çš„</li>
<li>-forwardInvocation:å¯ä»¥é€šè¿‡NSInvocationçš„å½¢å¼å°†æ¶ˆæ¯è½¬å‘ç»™å¤šä¸ªå¯¹è±¡ï¼Œä½†æ˜¯å…¶å¼€é”€è¾ƒå¤§ï¼Œéœ€è¦åˆ›å»ºæ–°çš„NSInvocationå¯¹è±¡ï¼Œå¹¶ä¸”forwardInvocationçš„å‡½æ•°ç»å¸¸è¢«ä½¿ç”¨è€…è°ƒç”¨ï¼Œæ¥åšå¤šå±‚æ¶ˆæ¯è½¬å‘é€‰æ‹©æœºåˆ¶ï¼Œä¸é€‚åˆå¤šæ¬¡é‡å†™</li>
<li>-forwardingTargetForSelector:å¯ä»¥å°†æ¶ˆæ¯è½¬å‘ç»™ä¸€ä¸ªå¯¹è±¡ï¼Œå¼€é”€è¾ƒå°ï¼Œå¹¶ä¸”è¢«é‡å†™çš„æ¦‚ç‡è¾ƒä½ï¼Œé€‚åˆé‡å†™</li>
</ol>
</blockquote>
<h4 id="1ä¸ºnsobjectæ·»åŠ hookæ‹¦æˆª-forwardingtargetforselector">1.ä¸ºNSObjectæ·»åŠ Hookæ‹¦æˆª<code>-forwardingTargetForSelector:</code></h4>
<p>Hookç”¨äºæ‹¦æˆªç³»ç»Ÿ<code>-forwardingTargetForSelector:</code>çš„æ‰§è¡Œï¼Œæ›¿æ¢ä¸ºæˆ‘ä»¬é‡å†™çš„<code>- (id)crashProtector_forwardingTargetForSelector:</code></p>
<pre><code class="language-Objective-C">#import &quot;NSObject+HookJQ.h&quot;

@implementation NSObject (HookJQ)

+ (void)crashProtectorSwizzlingClass:(Class)class
                    originalSelector:(SEL)originalSelector
                    swizzledSelector:(SEL)swizzledSelector{
    [self swizzlingInstanceMethodWithClass:class originalSelector:originalSelector swizzledSelector:swizzledSelector];
}

- (void)swizzlingInstanceMethodWithClass:(Class)class
                        originalSelector:(SEL)originalSelector
                        swizzledSelector:(SEL)swizzledSelector{
    Method originalMethod = class_getInstanceMethod(class, originalSelector);
    Method swizzledMethod = class_getInstanceMethod(class, swizzledSelector);

    method_exchangeImplementations(originalMethod, swizzledMethod);
}
@end
</code></pre>
<h4 id="2é‡å†™-forwardingtargetforselectoræ–¹æ³•">2.é‡å†™<code>-forwardingTargetForSelector:</code>æ–¹æ³•</h4>
<p>åŠ¨æ€åˆ›å»ºåä¸ºcrashProtectorClassçš„crashProtectorç±»ï¼Œå¹¶ä¸ºå…¶åŠ¨æ€æ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œæ–‡ä¸­çš„æ–¹æ³•ä¼ å…¥ä»€ä¹ˆéƒ½ç›´æ¥è¿”å›0ï¼Œç„¶åæŠŠæ¶ˆæ¯è½¬å‘åˆ°è¿™ä¸ªåŠ¨æ€åˆ›å»ºçš„ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œå®Œæˆcrashé˜²æŠ¤ã€‚</p>
<pre><code class="language-Objective-C">#import &quot;NSObject+CrashProtectorJQ.h&quot;
#import &quot;NSObject+HookJQ.h&quot;
@implementation NSObject (CrashProtectorJQ)

+ (void)load{
    //æ‹¦æˆªç³»ç»Ÿçš„æ–¹æ³•ï¼Œæ›¿æ¢æˆæˆ‘ä»¬çš„å®ç°
    [NSObject crashProtectorSwizzlingClass:[NSObject class] originalSelector:@selector(forwardingTargetForSelector:) swizzledSelector:@selector(crashProtector_forwardingTargetForSelector:)];
}

//é‡å†™çš„forwardingTargetForSelector:æ–¹æ³•
- (id)crashProtector_forwardingTargetForSelector:(SEL)aSelector{
    //éšæ„åŠ¨æ€åˆ›å»ºä¸€ä¸ªç±»
    Class crashProtectorClass = NSClassFromString(@&quot;crashProtector&quot;);
    if (!crashProtectorClass) {
        crashProtectorClass = objc_allocateClassPair([NSObject class], &quot;crashProtector&quot;, 0);
        //æ³¨å†Œè¯¥ç±»
        objc_registerClassPair(crashProtectorClass);
    }
    //å¦‚æœè¯¥ç±»æ²¡æœ‰å®ç°é‚£ä¸ªæ–¹æ³•ï¼ŒåŠ¨æ€æ·»åŠ ä¸€ä¸ªå®ç°
    if (!class_getInstanceMethod(NSClassFromString(@&quot;crashProtector&quot;), aSelector)) {
        class_addMethod(crashProtectorClass, aSelector, (IMP)crashPro, &quot;@@:@&quot;);
    }
    //è½¬å‘åˆ°crashProtectorçš„å®ä¾‹å¯¹è±¡
    return [crashProtectorClass new];
}
int crashPro(id slf ,SEL selector){
    return 0;
}
@end
</code></pre>
<h4 id="3æµ‹è¯•">3.æµ‹è¯•</h4>
<p>æ–°å»ºä¸€ä¸ªç±»TestObjç»§æ‰¿è‡ªNSObjectï¼Œå£°æ˜thisEmptyMethodæ–¹æ³•ï¼Œä½†ä¸å®ç°</p>
<pre><code class="language-Objective-C">#import &lt;Foundation/Foundation.h&gt;
NS_ASSUME_NONNULL_BEGIN

@interface TestObj : NSObject

- (void)thisEmptyMethod;

@end

@implementation TestObj

@end
</code></pre>
<p>ç¨‹åºå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä¸ä¼šcrash<br>
<img src="https://jiaqiwang98.github.io/post-images/1636285817532.png" alt="" loading="lazy"></p>
<p>æ³¨é‡Šæ‰crashé˜²æŠ¤æ–¹æ³•ï¼Œå‘ç”Ÿ<code>unrecognized selector sent to instance</code>å¼‚å¸¸ï¼Œç¨‹åºå´©æºƒ<br>
<img src="https://jiaqiwang98.github.io/post-images/1636285926681.png" alt="" loading="lazy"></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[æ¯æ—¥å­¦ä¹ è®°å½•]]></title>
        <id>https://jiaqiwang98.github.io/post/mei-ri-xue-xi-ji-lu/</id>
        <link href="https://jiaqiwang98.github.io/post/mei-ri-xue-xi-ji-lu/">
        </link>
        <updated>2021-10-31T10:47:15.000Z</updated>
        <content type="html"><![CDATA[<p>2021-10-28 ï¼ˆæ²¡æœ‰çœ‹å®Œï¼‰<br>
Objective-C Runtimeçš„åŸç† http://yulingtianxia.com/blog/2014/11/05/objective-c-runtime/<br>
ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»-é“¾æ¥ã€è£…è½½ä¸åº“ã€‹<br>
2021-10-29<br>
ã€å¤ä¹ ã€‘Objective-Cä¸­çš„copyï¼ˆéœ€è¦æ‰‹å†™demoéªŒè¯ä¸‹ï¼‰<br>
å…ˆäº†è§£å‡ ä¸ªæ¦‚å¿µ<br>
æ·±æ‹·è´ä¸æµ…æ‹·è´:<br>
æµ…æ‹·è´ï¼šåªå¤åˆ¶æŒ‡å‘æŸä¸ªå¯¹è±¡çš„æŒ‡é’ˆï¼Œè€Œä¸å¤åˆ¶å¯¹è±¡æœ¬èº«ï¼Œæ–°æ—§å¯¹è±¡ä½¿ç”¨åŒä¸€å—ç¼“å­˜<br>
æ·±æ‹·è´ï¼šåˆ›é€ ä¸€ä¸ªä¸€æ ·çš„æ–°å¯¹è±¡ï¼Œæ–°å¯¹è±¡ä¸åŸå¯¹è±¡å†…å­˜ä¸å…±ç”¨ï¼Œä¿®æ”¹æ–°å¯¹è±¡ä¸ä¼šæ”¹åˆ°åŸå¯¹è±¡<br>
OCçš„ç³»ç»Ÿéå®¹å™¨ç±»å¯¹è±¡ï¼šNSStringï¼ŒNSNumber<br>
å¯¹äºä¸å¯å˜å¯¹è±¡NSStringï¼Œè¿›è¡Œcopyï¼Œä¼šå¾—åˆ°ä¸å¯å˜å¯¹è±¡ï¼Œè€Œä¸”æ˜¯æµ…æ‹·è´<br>
å¯¹äºä¸å¯å˜å¯¹è±¡NSStringï¼Œè¿›è¡ŒmutableCopyï¼Œä¼šå¾—åˆ°å¯å˜å¯¹è±¡NSMutableStringï¼Œè€Œä¸”æ˜¯æ·±æ‹·è´<br>
å¯¹äºå¯å˜å¯¹è±¡NSMutableStringï¼Œè¿›è¡Œcopyï¼Œä¼šå¾—åˆ°ä¸å¯å˜å¯¹è±¡NSStringï¼Œè€Œä¸”æ˜¯æ·±æ‹·è´<br>
å¯¹äºå¯å˜å¯¹è±¡NSMutableStringï¼Œè¿›è¡ŒmutableCopyï¼Œä¼šå¾—åˆ°å¯å˜å¯¹è±¡ï¼Œè€Œä¸”æ˜¯æ·±æ‹·è´<br>
OCçš„ç³»ç»Ÿå®¹å™¨ç±»å¯¹è±¡ï¼šå¯ä»¥æŒ‰å­—é¢æ„æ€ç†è§£â€œå®¹å™¨ç±»â€æŒ‡æ•°ç»„NSArrayã€å­—å…¸NSDictionaryè¿™ç§å®¹çº³å¤šä¸ªå…ƒç´ çš„å¯¹è±¡<br>
è‡ªå®šä¹‰å¯¹è±¡çš„æ‹·è´ï¼šå¿…é¡»å®ç°NSCopyingåè®®ï¼Œæ·±æ‹·è´ä¸æµ…æ‹·è´ç”±copyWithZoneæ–¹æ³•çš„å®ç°æ¥æ§åˆ¶<br>
å‚è€ƒï¼š<br>
https://blog.csdn.net/qq_16844001/article/details/51887118?utm_medium=distribute.pc_relevant.none-task-blog-2<sub>default</sub>baidujs_title~default-1.no_search_link&amp;spm=1001.2101.3001.4242.2<br>
2021-10-31<br>
å¹³å°ä¸šåŠ¡æ–°äººåˆ†äº«è¯¾ç¨‹ã€Šæ·±å…¥æµ…å‡ºruntimeã€‹<br>
Objective-Cæ˜¯ä¸€é—¨è¿è¡Œæ—¶è¯­è¨€<br>
Runtimeå¯ä»¥åœ¨è¿è¡Œæ—¶åˆ›å»ºç±»ã€ä¿®æ”¹ç±»ã€å¯¹è±¡å’Œæ–¹æ³•<br>
2021-11-02<br>
ã€ŠiOSå¤šçº¿ç¨‹ï¼šã€GCDã€è¯¦å°½æ€»ç»“ã€‹<br>
https://juejin.cn/post/6844903566398717960#heading-17<br>
æ–‡ç« æ¥è‡ªä¸€ä¸ªå¤§ä½¬çš„åšå®¢ï¼šhttps://bujige.net/ å¤§ä½¬è®²è§£GCDéå¸¸é€å½»ï¼Œéå¸¸å–œæ¬¢è¿™ç±»çš„åšå®¢ã€‚æœ‰æŠ€æœ¯æœ‰ç”Ÿæ´»æœ‰æ¸©åº¦ï½</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å…³äº]]></title>
        <id>https://jiaqiwang98.github.io/post/about/</id>
        <link href="https://jiaqiwang98.github.io/post/about/">
        </link>
        <updated>2019-01-25T11:09:48.000Z</updated>
        <content type="html"><![CDATA[<!-- more -->
<blockquote>
<p>æ¬¢è¿æ¥åˆ°æˆ‘çš„Blogå‘€ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ¤</p>
</blockquote>
<h2 id="å…³äºæœ¬ç«™">ğŸ  å…³äºæœ¬ç«™</h2>
<h2 id="åšä¸»æ˜¯è°">ğŸ‘¨â€ğŸ’» åšä¸»æ˜¯è°</h2>
<p>iOS Client Research &amp; Development @ ByteDance User Growth(UG) Group</p>
<h2 id="å…´è¶£çˆ±å¥½">â›¹ å…´è¶£çˆ±å¥½</h2>
<h2 id="è”ç³»æˆ‘å‘€">ğŸ“¬ è”ç³»æˆ‘å‘€</h2>
]]></content>
    </entry>
</feed>